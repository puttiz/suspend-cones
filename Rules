#!/usr/bin/env ruby

# Loading

require "compass"

Compass.add_configuration "#{File.foreach(__FILE__)}/config.rb"
sass_options = Compass.sass_engine_options

# Compilation rules

compile '/assets/stylesheet/_*' do
  # Don't compile partials
end

compile '/assets/stylesheet/*' do
  filter :sass, sass_options.merge(:syntax => item[:extension].to_sym)
end

compile '*' do
  if item.binary?
    # donâ€™t filter binary items
  else
    filter :haml, :escape_attrs => false, :attr_wrapper => '"'
    layout item[:layout] ? item[:layout] : "default"
  end
end

# Routing rules

route '/assets/stylesheet/_*' do
  nil
end

route '/assets/stylesheet/*' do
  profile = item.identifier.split('/')[-2]
  'assets/stylesheet/#{profile}.css'

  # don't generate a directory like we do for HTML files
  # item.identifier.chop + '.css'
end

route '*' do
  if item.binary?
    # Write item with identifier /foo/ to /foo.ext
    item.identifier.chop + '.' + item[:extension]
  else
    # Write item with identifier /foo/ to /foo/index.html
    item.identifier + 'index.html'
  end
end

layout '*', :haml, :escape_attrs => false, :attr_wrapper => '"'
